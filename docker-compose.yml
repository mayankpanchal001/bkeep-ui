version: '3.8'

services:
    frontend:
        build:
            context: .
            dockerfile: Dockerfile
            args:
                # API endpoint - same for both local and production
                # Can be overridden with: VITE_API_ENDPOINT=<url> docker-compose build
                VITE_API_ENDPOINT: http://72.62.161.70:4000/api/v1
                # Environment type
                VITE_ENVIRONMENT: production

        image: bkeep-frontend:latest
        container_name: bkeep-frontend
        ports:
            # Map host port to container port 80
            # Override with: PORT=3000 docker-compose up
            - '80:80'
        restart: unless-stopped
        healthcheck:
            test:
                [
                    'CMD',
                    'wget',
                    '--quiet',
                    '--tries=1',
                    '--spider',
                    'http://localhost/health',
                ]
            interval: 30s
            timeout: 3s
            retries: 3
            start_period: 5s
        networks:
            - bkeep-network
        # Resource limits (optional, uncomment if needed)
        # deploy:
        #     resources:
        #         limits:
        #             cpus: '1'
        #             memory: 512M
        #         reservations:
        #             cpus: '0.5'
        #             memory: 256M

networks:
    bkeep-network:
        driver: bridge
